//  Copyright (c) 2021 - 2024, Zhengliang Liu
//  All rights reserved

/**
* @file lbm_d3q19.cpp
* @author Zhengliang Liu
* @brief define class used for LBM D3Q19 model.
* @date  2023-11-26
*/
#ifndef ROOTPROJECT_SOURCE_LBM_LBM_D3Q19_H_
#define ROOTPROJECT_SOURCE_LBM_LBM_D3Q19_H_
#include <array>
#include <memory>
#include "lbm_interface.h"
namespace rootproject {
namespace lbmproject {
// lattice 0:  (0  0  0)
// lattice 1 : (1  0  0)
// lattice 2 : (-1  0  0)
// lattice 3 : (0  1  0)
// lattice 4 : (0 - 1  0)
// lattice 5 : (0  0  1)
// lattice 6 : (0  0 - 1)

// lattice 7 : (+1 + 1  0)
// lattice 8 : (-1 + 1  0)
// lattice 9 : (+1 - 1  0)
// lattice 10: (-1 - 1  0)

// lattice 11: (+1  0 + 1)
// lattice 12: (-1  0 + 1)
// lattice 13: (+1  0 - 1)
// lattice 14: (-1  0 - 1)

// lattice 15: (0 + 1 + 1)
// lattice 16: (0 - 1 + 1)
// lattice 17: (0 + 1 - 1)
// lattice 18: (0 - 1 - 1)
class SolverLbmD3Q19 final :public SolverLbmInterface {
 public:
    // f
    static constexpr DefAmrIndexUint kFX0Y0Z0 = 0,
        kFXnY0Z0 = 2, kFXpY0Z0 = 1,  kFX0YnZ0 = 4, kFX0YpZ0 = 3, kFX0Y0Zn = 6, kFX0Y0Zp = 5,
        kFXnYnZ0 = 10, kFXnYpZ0 = 8, kFXpYnZ0 = 9, kFXpYpZ0 = 7, kFXnY0Zn = 14, kFXnY0Zp = 12,
        kFXpY0Zn = 13, kFXpY0Zp = 11, kFX0YnZn = 18, kFX0YnZp = 16, kFX0YpZn = 17, kFX0YpZp = 15;
        /**< indices of distribution functions*/
    static constexpr std::array<std::array<DefReal, 19>, 19> kMatrixMMrt = {{
        { 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., },
        { -30., -11., -11., -11., -11., -11., -11., 8., 8., 8., 8., 8., 8., 8., 8., 8., 8., 8., 8., },
        { 12., -4., -4., -4., -4., -4., -4., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., },
        { 0., 1., -1., 0., 0., 0., 0., 1., -1., 1., -1., 1., -1., 1., -1., 0., 0., 0., 0., },
        { 0., -4., 4., 0., 0., 0., 0., 1., -1., 1., -1., 1., -1., 1., -1., 0., 0., 0., 0., },
        { 0., 0., 0., 1., -1., 0., 0., 1., 1., -1., -1., 0., 0., 0., 0., 1., -1., 1., -1., },
        { 0., 0., 0., -4., 4., 0., 0., 1., 1., -1., -1., 0., 0., 0., 0., 1., -1., 1., -1., },
        { 0., 0., 0., 0., 0., 1., -1., 0., 0., 0., 0., 1., 1., -1., -1., 1., 1., -1., -1., },
        { 0., 0., 0., 0., 0., -4., 4., 0., 0., 0., 0., 1., 1., -1., -1., 1., 1., -1., -1., },
        { 0., 2., 2., -1., -1., -1., -1., 1., 1., 1., 1., 1., 1., 1., 1., -2., -2., -2., -2., },
        { 0., -4., -4., 2., 2., 2., 2., 1., 1., 1., 1., 1., 1., 1., 1., -2., -2., -2., -2., },
        { 0., 0., 0., 1., 1., -1., -1., 1., 1., 1., 1., -1., -1., -1., -1., 0., 0., 0., 0., },
        { 0., 0., 0., -2., -2., 2., 2., 1., 1., 1., 1., -1., -1., -1., -1., 0., 0., 0., 0., },
        { 0., 0., 0., 0., 0., 0., 0., 1., -1., -1., 1., 0., 0., 0., 0., 0., 0., 0., 0., },
        { 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., -1., -1., 1., },
        { 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., -1., -1., 1., 0., 0., 0., 0., },
        { 0., 0., 0., 0., 0., 0., 0., 1., -1., 1., -1., -1., 1., -1., 1., 0., 0., 0., 0., },
        { 0., 0., 0., 0., 0., 0., 0., -1., -1., 1., 1., 0., 0., 0., 0., 1., -1., 1., -1., },
        { 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 1., -1., -1., -1., -1., 1., 1., }
        }};
    static constexpr std::array<std::array<DefReal, 19>, 19> kMatrixImMrt = {{
        {1. / 19, - 5.  / 399,    1. /  21,  0. ,   0.   ,   0. ,   0.   ,   0.,    0.   ,   0.     ,
           0.     ,   0.     ,   0.     ,   0.  ,   0.  ,   0.  ,   0.   ,   0.   ,   0.},
        {1. / 19, - 11. / 2394, - 1. /  63,  0.1, - 0.1  ,   0. ,   0.   ,   0.,    0.   ,   1. / 18,
         - 1. / 18,   0.     ,   0.     ,   0.  ,   0.  ,   0.  ,   0.   ,   0.   ,   0.},
        {1. / 19, - 11. / 2394, - 1. /  63, -0.1,   0.1  ,   0. ,   0.   ,   0.,    0.   ,   1. / 18,
         - 1. / 18,   0.     ,   0.     ,   0.  ,   0.  ,   0.  ,   0.   ,   0.   ,   0.},
        {1. / 19, - 11. / 2394, - 1. /  63,  0. ,   0.   ,   0.1, - 0.1  ,   0.,    0.   , - 1. / 36,
           1. / 36,   1. / 12, - 1. / 12,   0.  ,   0.  ,   0.  ,   0.   ,   0.   ,   0.},
        {1. / 19, - 11. / 2394, - 1. /  63,  0. ,   0.   , - 0.1,   0.1  ,   0.,    0.   , - 1. / 36,
           1. / 36,   1. / 12, - 1. / 12,   0.  ,   0.  ,   0.  ,   0.   ,   0.   ,   0.},
        {1. / 19, - 11. / 2394, - 1. /  63,  0. ,   0.   ,   0. ,   0.   ,   0.1, - 0.1  , - 1. / 36,
           1. / 36, - 1. / 12,   1. / 12,   0.  ,   0.  ,   0.  ,   0.   ,   0.   ,   0.},
        {1. / 19, - 11. / 2394, - 1. /  63,  0. ,   0.   ,   0. ,   0.   , - 0.1,   0.1  , - 1. / 36,
           1. / 36, - 1. / 12,   1. / 12,   0.  ,   0.  ,   0.  ,   0.   ,   0.   ,   0.},
        {1. / 19,    4. / 1197,   1. / 252,  0.1,   0.025,   0.1,   0.025,   0.,    0.   ,   1. / 36,
           1. / 72,   1. / 12,   1. / 24,   0.25,   0.  ,   0.  ,   0.125, - 0.125,   0.},
        {1. / 19,    4. / 1197,   1. / 252, -0.1, - 0.025,   0.1,   0.025,   0.,    0.   ,   1. / 36,
           1. / 72,   1. / 12,   1. / 24, - 0.25,   0.  ,   0.  , - 0.125, - 0.125,   0.},
        {1. / 19,    4. / 1197,   1. / 252,  0.1,   0.025, - 0.1, - 0.025,   0.,    0.   ,   1. / 36,
           1. / 72,   1. / 12,   1. / 24, - 0.25,   0.  ,   0.  ,   0.125,   0.125,   0.},
        {1. / 19,    4. / 1197,   1. / 252, -0.1, - 0.025, - 0.1, - 0.025,   0.,    0.   ,   1. / 36,
           1. / 72,   1. / 12,   1. / 24,   0.25,   0.  ,   0.  , - 0.125,   0.125,   0.},
        {1. / 19,    4. / 1197,   1. / 252,  0.1,   0.025,   0. ,   0.   ,   0.1,   0.025,   1. / 36,
           1. / 72, - 1. / 12, - 1. / 24,   0.  ,   0.  ,   0.25, - 0.125,   0.   ,   0.125},
        {1. / 19,    4. / 1197,   1. / 252, -0.1, - 0.025,   0. ,   0.   ,   0.1,   0.025,   1. / 36,
           1. / 72, - 1. / 12, - 1. / 24,   0.  ,   0.  , - 0.25,   0.125,   0.   ,   0.125},
        {1. / 19,    4. / 1197,   1. / 252,  0.1,   0.025,   0. ,   0.   , - 0.1, - 0.025,   1. / 36,
           1. / 72, - 1. / 12, - 1. / 24,   0.  ,   0.  , - 0.25, - 0.125,   0.   , - 0.125},
        {1. / 19,    4. / 1197,   1. / 252, -0.1, - 0.025,   0. ,   0.   , - 0.1, - 0.025,   1. / 36,
           1. / 72, - 1. / 12, - 1. / 24,   0.  ,   0.  ,   0.25,   0.125,   0.   , - 0.125},
        {1. / 19,    4. / 1197,   1. / 252,  0. ,   0.   ,   0.1,   0.025,   0.1,   0.025, - 1. / 18,
         - 1. / 36,   0.     ,   0.     ,   0.  ,   0.25,   0.  ,   0.   ,   0.125, - 0.125},
        {1. / 19,    4. / 1197,   1. / 252,  0. ,   0.   , - 0.1, - 0.025,   0.1,   0.025, - 1. / 18,
         - 1. / 36,   0.     ,   0.     ,   0.  , - 0.25,   0.  ,   0.   , - 0.125, - 0.125},
        {1. / 19,    4. / 1197,   1. / 252,  0. ,   0.   ,   0.1,   0.025, - 0.1, - 0.025, - 1. / 18,
         - 1. / 36,   0.     ,   0.     ,   0.  , - 0.25,   0.  ,   0.   ,   0.125,   0.125},
        {1. / 19,    4. / 1197,   1. / 252,  0. ,   0.   , - 0.1, - 0.025, - 0.1, - 0.025, - 1. / 18,
         - 1. / 36,   0.     ,   0.     ,   0.  ,   0.25,   0.  ,   0.   , - 0.125,   0.125}
        }};
    void InitialModelDependencies() final;
    void Stream(const DefAmrUint flag_not_compute, const amrproject::SFBitsetAuxInterface& sfbitset_aux,
         DefMap<std::unique_ptr<GridNodeLbm>>* const ptr_map_grid_nodes) const final;
};
class SolverCreatorLbmD3Q19 final :public amrproject::SolverCreatorInterface {
 public:
    std::shared_ptr<amrproject::SolverInterface> CreateSolver() const override;
};
}  // end namespace lbmproject
}  // end namespace rootproject
#endif  // ROOTPROJECT_SOURCE_LBM_LBM_D3Q19_H_
